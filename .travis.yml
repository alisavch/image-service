language: go

go:
  - 1.x

services:
  - docker

before_install:
  - curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.24.0

script:
  - docker build -t backend:latest -f Dockerfile .
  - docker tag backend:latest $AWS_ACCOUNT.dkr.ecr.$AWS_REGION.amazonaws.com/backend:latest
  - docker build -t consumer:latest -f Dockerfile-consumer .
  - docker tag consumer:latest $AWS_ACCOUNT.dkr.ecr.$AWS_REGION.amazonaws.com/consumer:latest

after_script:
  - docker push $AWS_ACCOUNT.dkr.ecr.$AWS_REGION.amazonaws.com/backend:latest
  - docker push $AWS_ACCOUNT.dkr.ecr.$AWS_REGION.amazonaws.com/consumer:latest
  - docker-compose down
